<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      background-color: #fff0f5;
      font-family: 'Georgia', serif;
      margin: 0;
      padding: 0;
      color: #2c3e50;
      display: flex;
      flex-direction: column;
      align-items: center; /* center everything horizontally */
      min-height: 100vh;
      padding: 50px 10px;
      box-sizing: border-box;
    }

    .section {
      max-width: 800px;
      width: 100%;
      margin-bottom: 60px;
      padding: 20px;
      box-sizing: border-box;
    }

    #candle-section {
      text-align: center;
      border: 2px solid #e17055;
      border-radius: 10px;
      background: #fff5f8;
      max-width: 320px;
      padding: 20px;
      box-sizing: border-box;
    }

    #candle {
      width: 100px;
      height: 200px;
      background: url("{{candle_unlit}}") no-repeat center/contain;
      margin: 0 auto;
    }

    #blown {
      display: none;
      font-size: 24px;
      color: green;
      margin-top: 10px;
    }

    #picture-section {
      text-align: center;
      border: 2px solid #e17055;
      border-radius: 10px;
      background: #fff5f8;
      max-width: 600px;
      padding: 20px;
      box-sizing: border-box;
      display: none;
      animation: fadeIn 1.5s ease-in;
      margin: 0 auto;
    }

    #envelope-section {
      border: 2px solid #e17055;
      border-radius: 10px;
      background: #fff5f8;
      max-width: 350px;
      padding: 20px;
      box-sizing: border-box;
      display: none;
      animation: fadeIn 1.5s ease-in;
      margin: 0 auto;
    }

    h2 {
      margin-top: 0;
    }

    .envelope-container {
      display: flex;
      justify-content: center;
      cursor: pointer;
      margin-top: 20px;
    }

    .envelope {
      position: relative;
      width: 300px;
      min-height: 400px;
      background: #f8c291;
      overflow: hidden;
      border: 2px solid #e17055;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    .envelope .flap {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: #e17055;
      transform-origin: top;
      transition: transform 1s ease-in-out;
      z-index: 2;
      border-bottom: 2px solid #d35400;
    }

    .envelope.open .flap {
      transform: rotateX(-180deg);
    }

    .envelope .letter {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      padding: 20px;
      background: #fff;
      color: #2d3436;
      box-sizing: border-box;
      transition: top 1s ease-in-out;
      max-height: 500px;
      overflow-y: auto;
      z-index: 1;
    }

    .envelope.open .letter {
      top: 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

  <!-- Candle Section -->
  <div id="candle-section" class="section">
    <div id="candle"></div>
    <p id="blown">You blew out the candles! ðŸ¥³ðŸŽ‰</p>
  </div>

  <!-- Picture Section -->
  <div id="picture-section" class="section">
    <h2>ðŸŽ¬ PICTURE ABHI BHI BAAKI HAI ðŸŽ¬</h2>
  </div>

  <!-- Envelope Section -->
  <div id="envelope-section" class="section">
    <div class="envelope-container" onclick="openEnvelope()">
      <div class="envelope" id="envelope">
        <div class="flap"></div>
        <div class="letter">
          <p>Dear Sherly,</p>
          <p>Happy Birthday! ðŸŽ‰</p>
          <p>
            On your special day, I just wanted to say how much you mean to me. ðŸ’–<br><br>
            You're the sunshine on my cloudiest days, the calm in my storms, and the laughter in my silence.<br><br>
            We may be apart for miles, we may don't meet daily but always remember that I would always love you like I always did.<br><br>
            The strings of my breath always look for the muse of its rhythm<br>
            Rhythm to fly<br>
            Rhythm for brew<br>
            And in you, that rhythm softly grewâ€”<br>
            A song of joy, of time well spent,<br>
            Of laughter shared, of hearts unbeat.<br>
            Today, the tune just plays for you,<br>
            A birthday wish in every hueâ€”<br>
            May your days compose a melody<br>
            Of love, of peace, and harmony.<br><br>
            I hope this little app made you smile and gave you a tiny glimpse of how special you are to me.<br><br>
            May your birthday be filled with love, joy, and a million happy memories. ðŸŽ‰ðŸŽ‚<br><br>
            Happy Birthday once again! ðŸŽˆ<br><br>
            Hope this little app made you smile and feel special ^_^
          </p>
          <p>With love,</p>
          <p>From Your luv ðŸ’–</p>
        </div>
      </div>
    </div>
  </div>

<script>
  let audioContext = null;
  let analyser = null;
  let dataArray = null;
  let blown = false;

  function startMic() {
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(stream => {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaStreamSource(stream);
        analyser = audioContext.createAnalyser();
        source.connect(analyser);
        analyser.fftSize = 256;
        const bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
        listenToMic();
      })
      .catch(error => {
        console.error("Mic access denied", error);
      });
  }

  function listenToMic() {
    requestAnimationFrame(listenToMic);
    if (blown) return;

    analyser.getByteFrequencyData(dataArray);
    let volume = dataArray.reduce((a, b) => a + b) / dataArray.length;

    if (volume > 30) {  // Adjust if needed
      blown = true;

      document.getElementById("candle").style.backgroundImage = "url('{{candle_blown}}')";
      document.getElementById("blown").style.display = "block";

      // Show picture section after 1 sec
      setTimeout(() => {
        document.getElementById("picture-section").style.display = "block";
        window.scrollTo({ 
          top: document.getElementById("picture-section").offsetTop, 
          behavior: "smooth" 
        });
      }, 1000);

      // Show envelope section after 3 sec
      setTimeout(() => {
        document.getElementById("envelope-section").style.display = "block";
        window.scrollTo({ 
          top: document.getElementById("envelope-section").offsetTop, 
          behavior: "smooth" 
        });
      }, 3000);
    }
  }

  function openEnvelope() {
    document.getElementById("envelope").classList.add("open");
  }

  startMic();
</script>

</body>
</html>
